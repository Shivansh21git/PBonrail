 {% extends 'core/base.html' %}
{% load static %}
{% block title %}Dashboard - Plant Buddy{% endblock %}

{% block content %}
<div class="container">
  <h2>Welcome, {{ user.username }}</h2>

  {% comment %} <h3>Register a New Krishi Sarthi Device</h3> {% endcomment %}
<button id="toggleDeviceForm" class="btn-primary">+ Add New Device</button>
<div id="deviceFormContainer" style="display: none; margin-top: 1rem;">
<form method="post">
  {% csrf_token %}
  {{ form.as_p }}
  <button type="submit" class="btn-primary">Add Device</button>
</form>
</div>

<hr>
  <h3>Your Devices</h3>
  {% if devices %}
  <table class="device-table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Device ID</th>
        <th>Location</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for device in devices %}
      <tr>
        <td>{{ device.name }}</td>
        <td>{{ device.device_id }}</td>
        <td>{{ device.location }}</td>
        <td><a href="{% url 'device_data_page' device.device_id %}" class="btn-primary">View Data</a></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p>No devices found. <a href="#" id="showDeviceForm">Add one now</a>.</p>
  {% endif %}
</div>


<script>
  const toggleBtn = document.getElementById('toggleDeviceForm');
  const formContainer = document.getElementById('deviceFormContainer');
  const showLink = document.getElementById('showDeviceForm');
if(toggleBtn){
  toggleBtn.addEventListener('click', () => {
    if (formContainer.style.display === 'none') {
      formContainer.style.display = 'block';
      toggleBtn.textContent = 'Cancel';
    } else {
      formContainer.style.display = 'none';
      toggleBtn.textContent = '+ Add New Device';
    }
  });}
if (showLink) {
  showLink.addEventListener('click', (e) => {
  e.preventDefault();
  formContainer.style.display = 'block';
  if (toggleBtn) toggleBtn.textContent = 'Cancel';
    });
  }
</script>

{% endblock %} 
